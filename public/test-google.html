<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Prueba Google OAuth (popup)</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
  </head>
  <body>
    <div id="buttonDiv"></div>

    <script>
      function handleCredentialResponse(response) {
        const idToken = response.credential; // ID Token de Google
        fetch('http://localhost:8080/auth/google', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ idToken })
        })
          .then(r => r.json())
          .then(data => {
            console.log('Respuesta backend:', data);
            alert('Login con Google OK. Revisa la consola del navegador.');
          })
          .catch(err => console.error(err));
      }

      window.onload = function () {
        google.accounts.id.initialize({
          client_id: '937828160345-d0vl1st38905e6b8dguaig5qq9f7cc68.apps.googleusercontent.com',
          callback: handleCredentialResponse,
          ux_mode: 'popup' // evita fricción con FedCM/One Tap
        });

        google.accounts.id.renderButton(
          document.getElementById('buttonDiv'),
          { type: 'standard', theme: 'outline', size: 'large' }
        );

        // No llamamos google.accounts.id.prompt() para mantener sólo popup
      };
    </script>
  </body>
</html>
